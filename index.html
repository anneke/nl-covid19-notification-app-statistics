<html>
    <h1>Statistieken CoronaMelder.nl</h1>

    <article>
      <h2>Mensen die CoronaMelder gedownload hebben</h2>

      <strong id="aantalDownloads"></strong>

      <figure class="grafiek">
        <div id="grafiekDownloads"></div>
        <figcaption>De grafiek laat zien hoeveel mensen CoronaMelder
          hebben gedownload.</figcaption>
      </figure>

      <p><strong id="aantalDownloadsPercentageBevolking"></strong> van de Nederlandse bevolking heeft
        CoronaMelder gedownload.</p>
    </article>

    <article>
      <h2>Mensen die anderen waarschuwden via CoronaMelder</h2>
      <p>Verticaal: aantal, horizontaal datum</p>
      <p>line chart</p>
      <div id="aantalWaarschuwingen"></div>
      <p>
        Als je positief getest bent op corona, dan kun je dit
        vrijwillig aangeven in de app, samen met een
        medewerker van de GGD.<br />
        De grafiek laat zien hoeveel mensen dit hebben gedaan
        na landelijke introductie van CoronaMelder op 10
        oktober
      </p>
    </article>

    <script src="https://d3js.org/d3.v6.min.js"></script>
    <script src="https://d3js.org/d3-time.v2.min.js"></script>
    <script src="https://d3js.org/d3-time-format.v3.min.js"></script>
    <script>
        d3.csv("statistics/appstore_statistics.csv", function(data) {
        return {
          test: data["Date (yyyy-mm-dd)"],
          downloads_iOS_daily :  +data["Downloads App Store (iOS) (daily)"],
          downloads_PlayStore_daily : +data["Downloads Play Store (Android) (daily)"],
          downloads_Huawei_daily : +data["Downloads Huawei App Gallery (Android) (daily)"],
          downloads_Total_daily : +data["Total downloads (daily)"],
          downloads_Total_cumulative : +data["Total downloads (cumulative)"],
        };
      }).then(function(data) {
        // get total number of downloads
        const aantalDownloads = document.getElementById("aantalDownloads");
        aantalDownloads.innerHTML = data[data.length - 1].downloads_Total_cumulative.toLocaleString('nl-NL');

        // get number of downloads and use it to calculate the percentage of the total number of Dutchies
        const aantalDownloadsPercentageBevolking = document.getElementById("aantalDownloadsPercentageBevolking");
        const bevolkingNederland = 17472667;
        const calcPercentage = (data[data.length - 1].downloads_Total_cumulative / bevolkingNederland) * 100;
        aantalDownloadsPercentageBevolking.innerHTML = calcPercentage.toFixed(2) + '%';

        function barChart(data) {
          var w= 1200;
          var h= 400;

          var svg= d3.select('#grafiekDownloads')
              .append('svg')
              .attr('width', w)
              .attr('height', h);

          svg.selectAll('rect.colorBar')
              .data(data)
              .enter()
              .append('rect')
              .attr('width', function(d,i){
                  return w / data.length;
              })
              .attr('height', function(d,i){
                  const test = (h / data[i].downloads_Total_cumulative) * 100;
                  return test;
              })
              .attr('x', function(d,i){
                  return i * (d.width+2)
              })
              .attr('y', function(d,i){
                  return h - d.height*2
              })
              .attr('fill', 'blue')
          }

          barChart(data[data.length - 1]);
      });
    </script>
</html>

